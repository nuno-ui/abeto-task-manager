ai_potential, ai_assist_description,
            tools_needed, knowledge_areas, acceptance_criteria,
            success_metrics, risks, is_foundational, is_critical_path, order_index
        ) VALUES (
            project_record.id,
            'Alerting System',
            'Build alerts for SLA breaches and performance degradation.',
            'development',
            'not_started',
            'medium',
            '12-16h',
            'high',
            '',
            ARRAY['Slack API', 'Node.js'],
            ARRAY['API Integration', 'Business Logic'],
            ARRAY['Slack alerts working', 'Thresholds configurable', 'Escalation rules active'],
            ARRAY[]::TEXT[],
            ARRAY[]::TEXT[],
            FALSE,
            TRUE,
            task_order
        ) ON CONFLICT DO NOTHING;
        task_order := task_order + 1;

        -- Task: Installer Leaderboard
        INSERT INTO tasks (
            project_id, title, description, phase, status, difficulty,
            estimated_hours, ai_potential, ai_assist_description,
            tools_needed, knowledge_areas, acceptance_criteria,
            success_metrics, risks, is_foundational, is_critical_path, order_index
        ) VALUES (
            project_record.id,
            'Installer Leaderboard',
            'Create public leaderboard to motivate installer performance.',
            'development',
            'not_started',
            'easy',
            '8-12h',
            'high',
            '',
            ARRAY['React'],
            ARRAY['Frontend/React'],
            ARRAY['Leaderboard deployed', 'Rankings updating', 'Privacy settings respected'],
            ARRAY[]::TEXT[],
            ARRAY[]::TEXT[],
            FALSE,
            FALSE,
            task_order
        ) ON CONFLICT DO NOTHING;
        task_order := task_order + 1;

        -- Task: Validation & Calibration
        INSERT INTO tasks (
            project_id, title, description, phase, status, difficulty,
            estimated_hours, ai_potential, ai_assist_description,
            tools_needed, knowledge_areas, acceptance_criteria,
            success_metrics, risks, is_foundational, is_critical_path, order_index
        ) VALUES (
            project_record.id,
            'Validation & Calibration',
            'Validate metrics with historical data and calibrate thresholds.',
            'testing',
            'not_started',
            'medium',
            '12-16h',
            'medium',
            '',
            ARRAY['Analytics tools'],
            ARRAY['Data Analytics', 'Business Logic'],
            ARRAY['Metrics validated against manual calculations', 'Thresholds adjusted', 'Edge cases handled'],
            ARRAY[]::TEXT[],
            ARRAY[]::TEXT[],
            FALSE,
            TRUE,
            task_order
        ) ON CONFLICT DO NOTHING;
        task_order := task_order + 1;

        -- Task: Installer Communication
        INSERT INTO tasks (
            project_id, title, description, phase, status, difficulty,
            estimated_hours, ai_potential, ai_assist_description,
            tools_needed, knowledge_areas, acceptance_criteria,
            success_metrics, risks, is_foundational, is_critical_path, order_index
        ) VALUES (
            project_record.id,
            'Installer Communication',
            'Communicate new tracking system to installers and address concerns.',
            'training',
            'not_started',
            'easy',
            '8-12h',
            'medium',
            '',
            ARRAY['Communication tools'],
            ARRAY['Change Management', 'Stakeholder Management'],
            ARRAY['All installers informed', 'FAQ document created', 'Feedback collected'],
            ARRAY[]::TEXT[],
            ARRAY[]::TEXT[],
            FALSE,
            FALSE,
            task_order
        ) ON CONFLICT DO NOTHING;
        task_order := task_order + 1;

        -- Task: Launch & Optimize
        INSERT INTO tasks (
            project_id, title, description, phase, status, difficulty,
            estimated_hours, ai_potential, ai_assist_description,
            tools_needed, knowledge_areas, acceptance_criteria,
            success_metrics, risks, is_foundational, is_critical_path, order_index
        ) VALUES (
            project_record.id,
            'Launch & Optimize',
            'Launch tracking system and establish review cadence.',
            'rollout',
            'not_started',
            'easy',
            '8-12h',
            'low',
            '',
            ARRAY['Dashboards'],
            ARRAY['Change Management'],
            ARRAY['System live', 'Weekly reviews scheduled', 'Improvement actions tracked'],
            ARRAY['15% improvement in average conversion rate', '20% reduction in SLA breaches'],
            ARRAY[]::TEXT[],
            FALSE,
            TRUE,
            task_order
        ) ON CONFLICT DO NOTHING;
        task_order := task_order + 1;

        ELSE
            RAISE NOTICE 'Skipping installer-performance-tracking - already has % tasks', existing_task_count;
        END IF;
    END IF;

    -- =========================================================================
    -- DYNAMIC ALLOCATION ENGINE
    -- =========================================================================
    SELECT id INTO project_record FROM projects WHERE slug = 'dynamic-allocation-engine';
    IF project_record.id IS NOT NULL THEN
        -- Check if project already has tasks
        SELECT COUNT(*) INTO existing_task_count FROM tasks WHERE project_id = project_record.id;
        IF existing_task_count = 0 THEN
            task_order := 0;

        -- Task: Allocation Rules Discovery
        INSERT INTO tasks (
            project_id, title, description, phase, status, difficulty,
            estimated_hours, ai_potential, ai_assist_description,
            tools_needed, knowledge_areas, acceptance_criteria,
            success_metrics, risks, is_foundational, is_critical_path, order_index
        ) VALUES (
            project_record.id,
            'Allocation Rules Discovery',
            'Document current allocation rules, pain points, and desired improvements.',
            'discovery',
            'not_started',
            'medium',
            '12-16h',
            'medium',
            '',
            ARRAY['Documentation', 'Analytics'],
            ARRAY['Business Logic', 'Data Analytics'],
            ARRAY['Current rules documented', 'Pain points identified', 'Success criteria defined'],
            ARRAY[]::TEXT[],
            ARRAY[]::TEXT[],
            FALSE,
            TRUE,
            task_order
        ) ON CONFLICT DO NOTHING;
        task_order := task_order + 1;

        -- Task: Scoring Model Design
        INSERT INTO tasks (
            project_id, title, description, phase, status, difficulty,
            estimated_hours, ai_potential, ai_assist_description,
            tools_needed, knowledge_areas, acceptance_criteria,
            success_metrics, risks, is_foundational, is_critical_path, order_index
        ) VALUES (
            project_record.id,
            'Scoring Model Design',
            'Design lead-installer matching algorithm considering capacity, performance, location.',
            'planning',
            'not_started',
            'hard',
            '16-24h',
            'high',
            '',
            ARRAY['Documentation', 'Analytics'],
            ARRAY['Data Analytics', 'Business Logic'],
            ARRAY['Algorithm specification complete', 'Weighting factors defined', 'Edge cases documented'],
            ARRAY[]::TEXT[],
            ARRAY[]::TEXT[],
            FALSE,
            FALSE,
            task_order
        ) ON CONFLICT DO NOTHING;
        task_order := task_order + 1;

        -- Task: Real-time Capacity Tracking
        INSERT INTO tasks (
            project_id, title, description, phase, status, difficulty,
            estimated_hours, ai_potential, ai_assist_description,
            tools_needed, knowledge_areas, acceptance_criteria,
            success_metrics, risks, is_foundational, is_critical_path, order_index
        ) VALUES (
            project_record.id,
            'Real-time Capacity Tracking',
            'Build system to track installer capacity in real-time.',
            'development',
            'not_started',
            'hard',
            '20-28h',
            'medium',
            '',
            ARRAY['Node.js', 'PostgreSQL', 'Redis'],
            ARRAY['Database/SQL', 'API Integration'],
            ARRAY['Capacity updating in real-time', 'Installer self-service working', 'Historical tracking active'],
            ARRAY[]::TEXT[],
            ARRAY[]::TEXT[],
            FALSE,
            TRUE,
            task_order
        ) ON CONFLICT DO NOTHING;
        task_order := task_order + 1;

        -- Task: Scoring Engine Implementation
        INSERT INTO tasks (
            project_id, title, description, phase, status, difficulty,
            estimated_hours, ai_potential, ai_assist_description,
            tools_needed, knowledge_areas, acceptance_criteria,
            success_metrics, risks, is_foundational, is_critical_path, order_index
        ) VALUES (
            project_record.id,
            'Scoring Engine Implementation',
            'Implement the lead-installer matching algorithm.',
            'development',
            'not_started',
            'hard',
            '24-32h',
            'high',
            '',
            ARRAY['Node.js', 'PostgreSQL'],
            ARRAY['Business Logic', 'Database/SQL'],
            ARRAY['Algorithm deployed', 'Scores calculating correctly', 'Performance optimized'],
            ARRAY[]::TEXT[],
            ARRAY[]::TEXT[],
            FALSE,
            FALSE,
            task_order
        ) ON CONFLICT DO NOTHING;
        task_order := task_order + 1;

        -- Task: Allocation Router
        INSERT INTO tasks (
            project_id, title, description, phase, status, difficulty,
            estimated_hours, ai_potential, ai_assist_description,
            tools_needed, knowledge_areas, acceptance_criteria,
            success_metrics, risks, is_foundational, is_critical_path, order_index
        ) VALUES (
            project_record.id,
            'Allocation Router',
            'Build router that allocates leads based on scores and capacity.',
            'development',
            'not_started',
            'hard',
            '16-24h',
            'medium',
            '',
            ARRAY['Node.js', 'Zoho API'],
            ARRAY['API Integration', 'Business Logic'],
            ARRAY['Automatic allocation working', 'Fallback rules implemented', 'Manual override available'],
            ARRAY[]::TEXT[],
            ARRAY[]::TEXT[],
            FALSE,
            TRUE,
            task_order
        ) ON CONFLICT DO NOTHING;
        task_order := task_order + 1;

        -- Task: Admin Dashboard
        INSERT INTO tasks (
            project_id, title, description, phase, status, difficulty,
            estimated_hours, ai_potential, ai_assist_description,
            tools_needed, knowledge_areas, acceptance_criteria,
            success_metrics, risks, is_foundational, is_critical_path, order_index
        ) VALUES (
            project_record.id,
            'Admin Dashboard',
            'Build dashboard for ops to monitor and adjust allocation rules.',
            'development',
            'not_started',
            'medium',
            '16-20h',
            'high',
            '',
            ARRAY['React'],
            ARRAY['Frontend/React'],
            ARRAY['Dashboard deployed', 'Rules editable', 'Allocation history visible'],
            ARRAY[]::TEXT[],
            ARRAY[]::TEXT[],
            FALSE,
            FALSE,
            task_order
        ) ON CONFLICT DO NOTHING;
        task_order := task_order + 1;

        -- Task: Deviation Alerts
        INSERT INTO tasks (
            project_id, title, description, phase, status, difficulty,
            estimated_hours, ai_potential, ai_assist_description,
            tools_needed, knowledge_areas, acceptance_criteria,
            success_metrics, risks, is_foundational, is_critical_path, order_index
        ) VALUES (
            project_record.id,
            'Deviation Alerts',
            'Build alerts when allocation deviates from expected patterns.',
            'development',
            'not_started',
            'medium',
            '8-12h',
            'high',
            '',
            ARRAY['Slack API', 'Node.js'],
            ARRAY['API Integration', 'Business Logic'],
            ARRAY['Alerts configured', 'Thresholds set', 'Escalation working'],
            ARRAY[]::TEXT[],
            ARRAY[]::TEXT[],
            FALSE,
            FALSE,
            task_order
        ) ON CONFLICT DO NOTHING;
        task_order := task_order + 1;

        -- Task: A/B Testing Framework
        INSERT INTO tasks (
            project_id, title, description, phase, status, difficulty,
            estimated_hours, ai_potential, ai_assist_description,
            tools_needed, knowledge_areas, acceptance_criteria,
            success_metrics, risks, is_foundational, is_critical_path, order_index
        ) VALUES (
            project_record.id,
            'A/B Testing Framework',
            'Build framework to test allocation algorithm variations.',
            'testing',
            'not_started',
            'hard',
            '12-16h',
            'high',
            '',
            ARRAY['Node.js', 'Analytics'],
            ARRAY['Data Analytics', 'Business Logic'],
            ARRAY['A/B framework deployed', 'Traffic splitting working', 'Results tracking active'],
            ARRAY[]::TEXT[],
            ARRAY[]::TEXT[],
            FALSE,
            TRUE,
            task_order
        ) ON CONFLICT DO NOTHING;
        task_order := task_order + 1;

        -- Task: Installer Training
        INSERT INTO tasks (
            project_id, title, description, phase, status, difficulty,
            estimated_hours, ai_potential, ai_assist_description,
            tools_needed, knowledge_areas, acceptance_criteria,
            success_metrics, risks, is_foundational, is_critical_path, order_index
        ) VALUES (
            project_record.id,
            'Installer Training',
            'Train installers on new allocation system and capacity management.',
            'training',
            'not_started',
            'easy',
            '8-12h',
            'medium',
            '',
            ARRAY['Training materials'],
            ARRAY['Training & Documentation', 'Change Management'],
            ARRAY['All installers trained', 'Documentation complete', 'FAQ published'],
            ARRAY[]::TEXT[],
            ARRAY[]::TEXT[],
            FALSE,
            FALSE,
            task_order
        ) ON CONFLICT DO NOTHING;
        task_order := task_order + 1;

        -- Task: Phased Rollout
        INSERT INTO tasks (
            project_id, title, description, phase, status, difficulty,
            estimated_hours, ai_potential, ai_assist_description,
            tools_needed, knowledge_areas, acceptance_criteria,
            success_metrics, risks, is_foundational, is_critical_path, order_index
        ) VALUES (
            project_record.id,
            'Phased Rollout',
            'Roll out new allocation engine starting with pilot regions.',
            'rollout',
            'not_started',
            'medium',
            '16-24h',
            'low',
            '',
            ARRAY['Dashboards', 'Communication tools'],
            ARRAY['Change Management'],
            ARRAY['Pilot successful', 'Full rollout complete', 'Old system deprecated'],
            ARRAY['10% improvement in conversion rate', '15% better installer utilization'],
            ARRAY[]::TEXT[],
            FALSE,
            TRUE,
            task_order
        ) ON CONFLICT DO NOTHING;
        task_order := task_order + 1;

        ELSE
            RAISE NOTICE 'Skipping dynamic-allocation-engine - already has % tasks', existing_task_count;
        END IF;
    END IF;

    -- =========================================================================
    -- WHATSAPP CONVERSATION SUMMARY
    -- =========================================================================
    SELECT id INTO project_record FROM projects WHERE slug = 'whatsapp-conversation-summary';
    IF project_record.id IS NOT NULL THEN
        -- Check if project already has tasks
        SELECT COUNT(*) INTO existing_task_count FROM tasks WHERE project_id = project_record.id;
        IF existing_task_count = 0 THEN
            task_order := 0;

        -- Task: SDR Workflow Analysis
        INSERT INTO tasks (
            project_id, title, description, phase, status, difficulty,
            estimated_hours, ai_potential, ai_assist_description,
            tools_needed, knowledge_areas, acceptance_criteria,
            success_metrics, risks, is_foundational, is_critical_path, order_index
        ) VALUES (
            project_record.id,
            'SDR Workflow Analysis',
            'Observe SDR call prep workflow. Identify time spent reading WhatsApp history.',
            'discovery',
            'not_started',
            'easy',
            '8-12h',
            'low',
            '',
            ARRAY['Screen recording', 'Documentation'],
            ARRAY['Business Logic', 'Process Design'],
            ARRAY['Current workflow documented', 'Time spent measured', 'Pain points identified'],
            ARRAY[]::TEXT[],
            ARRAY[]::TEXT[],
            FALSE,
            TRUE,
            task_order
        ) ON CONFLICT DO NOTHING;
        task_order := task_order + 1;

        -- Task: Summary Format Design
        INSERT INTO tasks (
            project_id, title, description, phase, status, difficulty,
            estimated_hours, ai_potential, ai_assist_description,
            tools_needed, knowledge_areas, acceptance_criteria,
            success_metrics, risks, is_foundational, is_critical_path, order_index
        ) VALUES (
            project_record.id,
            'Summary Format Design',
            'Design summary format - what info to include, length, structure.',
            'planning',
            'not_started',
            'easy',
            '6-8h',
            'medium',
            '',
            ARRAY['Documentation'],
            ARRAY['UX Design', 'Business Logic'],
            ARRAY['Summary template approved', 'Key fields identified', 'Length guidelines set'],
            ARRAY[]::TEXT[],
            ARRAY[]::TEXT[],
            FALSE,
            FALSE,
            task_order
        ) ON CONFLICT DO NOTHING;
        task_order := task_order + 1;

        -- Task: WhatsApp API Integration
        INSERT INTO tasks (
            project_id, title, description, phase, status, difficulty,
            estimated_hours, ai_potential, ai_assist_description,
            tools_needed, knowledge_areas, acceptance_criteria,
            success_metrics, risks, is_foundational, is_critical_path, order_index
        ) VALUES (
            project_record.id,
            'WhatsApp API Integration',
            'Build integration to fetch conversation history from Woztell.',
            'development',
            'not_started',
            'medium',
            '16-24h',
            'medium',
            '',
            ARRAY['Woztell API', 'Node.js'],
            ARRAY['API Integration'],
            ARRAY['History fetching working', 'Pagination handled', 'Error handling robust'],
            ARRAY[]::TEXT[],
            ARRAY[]::TEXT[],
            TRUE,
            TRUE,
            task_order
        ) ON CONFLICT DO NOTHING;
        task_order := task_order + 1;

        -- Task: LLM Summary Generator
        INSERT INTO tasks (
            project_id, title, description, phase, status, difficulty,
            estimated_hours, ai_potential, ai_assist_description,
            tools_needed, knowledge_areas, acceptance_criteria,
            success_metrics, risks, is_foundational, is_critical_path, order_index
        ) VALUES (
            project_record.id,
            'LLM Summary Generator',
            'Build LLM-based summarizer using Claude/GPT.',
            'development',
            'not_started',
            'medium',
            '12-16h',
            'high',
            '',
            ARRAY['LLM API', 'Node.js'],
            ARRAY['LLM/Prompt Engineering'],
            ARRAY['Summaries generating', 'Quality validated', 'Latency acceptable'],
            ARRAY[]::TEXT[],
            ARRAY[]::TEXT[],
            FALSE,
            FALSE,
            task_order
        ) ON CONFLICT DO NOTHING;
        task_order := task_order + 1;

        -- Task: SDR Portal Integration
        INSERT INTO tasks (
            project_id, title, description, phase, status, difficulty,
            estimated_hours, ai_potential, ai_assist_description,
            tools_needed, knowledge_areas, acceptance_criteria,
            success_metrics, risks, is_foundational, is_critical_path, order_index
        ) VALUES (
            project_record.id,
            'SDR Portal Integration',
            'Embed summary view in SDR portal before call screens.',
            'development',
            'not_started',
            'easy',
            '8-12h',
            'high',
            '',
            ARRAY['React'],
            ARRAY['Frontend/React'],
            ARRAY['Summary visible in portal', 'Loading states handled', 'Refresh working'],
            ARRAY[]::TEXT[],
            ARRAY[]::TEXT[],
            FALSE,
            TRUE,
            task_order
        ) ON CONFLICT DO NOTHING;
        task_order := task_order + 1;

        -- Task: Pilot with SDR Team
        INSERT INTO tasks (
            project_id, title, description, phase, status, difficulty,
            estimated_hours, ai_potential, ai_assist_description,
            tools_needed, knowledge_areas, acceptance_criteria,
            success_metrics, risks, is_foundational, is_critical_path, order_index
        ) VALUES (
            project_record.id,
            'Pilot with SDR Team',
            'Pilot with 2-3 SDRs and collect feedback on summary quality.',
            'testing',
            'not_started',
            'easy',
            '8-12h',
            'low',
            '',
            ARRAY['Feedback forms'],
            ARRAY['Stakeholder Management'],
            ARRAY['Pilot completed', 'Feedback collected', 'Improvements identified'],
            ARRAY[]::TEXT[],
            ARRAY[]::TEXT[],
            FALSE,
            FALSE,
            task_order
        ) ON CONFLICT DO NOTHING;
        task_order := task_order + 1;

        -- Task: Launch to All SDRs
        INSERT INTO tasks (
            project_id, title, description, phase, status, difficulty,
            estimated_hours, ai_potential, ai_assist_description,
            tools_needed, knowledge_areas, acceptance_criteria,
            success_metrics, risks, is_foundational, is_critical_path, order_index
        ) VALUES (
            project_record.id,
            'Launch to All SDRs',
            'Roll out to full SDR team with training.',
            'rollout',
            'not_started',
            'easy',
            '6-8h',
            'low',
            '',
            ARRAY['Training materials'],
            ARRAY['Change Management'],
            ARRAY['All SDRs using feature', 'Documentation complete'],
            ARRAY['2+ min saved per call prep', '90% SDR adoption'],
            ARRAY[]::TEXT[],
            FALSE,
            TRUE,
            task_order
        ) ON CONFLICT DO NOTHING;
        task_order := task_order + 1;

        ELSE
            RAISE NOTICE 'Skipping whatsapp-conversation-summary - already has % tasks', existing_task_count;
        END IF;
    END IF;

    -- =========================================================================
    -- CONTACT PRIORITIZATION ENGINE
    -- =========================================================================
    SELECT id INTO project_record FROM projects WHERE slug = 'contact-prioritization-engine';
    IF project_record.id IS NOT NULL THEN
        -- Check if project already has tasks
        SELECT COUNT(*) INTO existing_task_count FROM tasks WHERE project_id = project_record.id;
        IF existing_task_count = 0 THEN
            task_order := 0;

        -- Task: Conversion Factor Analysis
        INSERT INTO tasks (
            project_id, title, description, phase, status, difficulty,
            estimated_hours, ai_potential, ai_assist_description,
            tools_needed, knowledge_areas, acceptance_criteria,
            success_metrics, risks, is_foundational, is_critical_path, order_index
        ) VALUES (
            project_record.id,
            'Conversion Factor Analysis',
            'Analyze historical data to identify factors that predict conversion.',
            'discovery',
            'not_started',
            'hard',
            '16-24h',
            'high',
            '',
            ARRAY['Analytics tools', 'SQL'],
            ARRAY['Data Analytics', 'Business Logic'],
            ARRAY['Key factors identified', 'Correlation analysis complete', 'Insights documented'],
            ARRAY[]::TEXT[],
            ARRAY[]::TEXT[],
            FALSE,
            TRUE,
            task_order
        ) ON CONFLICT DO NOTHING;
        task_order := task_order + 1;

        -- Task: Scoring Model Design
        INSERT INTO tasks (
            project_id, title, description, phase, status, difficulty,
            estimated_hours, ai_potential, ai_assist_description,
            tools_needed, knowledge_areas, acceptance_criteria,
            success_metrics, risks, is_foundational, is_critical_path, order_index
        ) VALUES (
            project_record.id,
            'Scoring Model Design',
            'Design scoring algorithm incorporating identified conversion factors.',
            'planning',
            'not_started',
            'hard',
            '12-16h',
            'high',
            '',
            ARRAY['Documentation', 'Analytics'],
            ARRAY['Data Analytics', 'Business Logic'],
            ARRAY['Algorithm specification complete', 'Weighting defined', 'Edge cases documented'],
            ARRAY[]::TEXT[],
            ARRAY[]::TEXT[],
            FALSE,
            FALSE,
            task_order
        ) ON CONFLICT DO NOTHING;
        task_order := task_order + 1;

        -- Task: Scoring Engine Development
        INSERT INTO tasks (
            project_id, title, description, phase, status, difficulty,
            estimated_hours, ai_potential, ai_assist_description,
            tools_needed, knowledge_areas, acceptance_criteria,
            success_metrics, risks, is_foundational, is_critical_path, order_index
        ) VALUES (
            project_record.id,
            'Scoring Engine Development',
            'Build real-time scoring engine for contact prioritization.',
            'development',
            'not_started',
            'hard',
            '20-28h',
            'high',
            '',
            ARRAY['Node.js', 'PostgreSQL', 'Redis'],
            ARRAY['Database/SQL', 'API Integration'],
            ARRAY['Scores calculating correctly', 'Real-time updates working', 'API endpoints ready'],
            ARRAY[]::TEXT[],
            ARRAY[]::TEXT[],
            FALSE,
            TRUE,
            task_order
        ) ON CONFLICT DO NOTHING;
        task_order := task_order + 1;

        -- Task: Best Time-to-Call Analysis
        INSERT INTO tasks (
            project_id, title, description, phase, status, difficulty,
            estimated_hours, ai_potential, ai_assist_description,
            tools_needed, knowledge_areas, acceptance_criteria,
            success_metrics, risks, is_foundational, is_critical_path, order_index
        ) VALUES (
            project_record.id,
            'Best Time-to-Call Analysis',
            'Analyze call patterns to determine optimal contact times per lead.',
            'development',
            'not_started',
            'medium',
            '12-16h',
            'high',
            '',
            ARRAY['Analytics', 'Aircall data'],
            ARRAY['Data Analytics'],
            ARRAY['Optimal times identified', 'Model trained', 'Recommendations generating'],
            ARRAY[]::TEXT[],
            ARRAY[]::TEXT[],
            FALSE,
            FALSE,
            task_order
        ) ON CONFLICT DO NOTHING;
        task_order := task_order + 1;

        -- Task: Prioritized Queue UI
        INSERT INTO tasks (
            project_id, title, description, phase, status, difficulty,
            estimated_hours, ai_potential, ai_assist_description,
            tools_needed, knowledge_areas, acceptance_criteria,
            success_metrics, risks, is_foundational, is_critical_path, order_index
        ) VALUES (
            project_record.id,
            'Prioritized Queue UI',
            'Build UI showing contacts ranked by score with call time recommendations.',
            'development',
            'not_started',
            'medium',
            '12-16h',
            'high',
            '',
            ARRAY['React'],
            ARRAY['Frontend/React', 'UX Design'],
            ARRAY['Queue displayed', 'Scores visible', 'Best time shown'],
            ARRAY[]::TEXT[],
            ARRAY[]::TEXT[],
            FALSE,
            TRUE,
            task_order
        ) ON CONFLICT DO NOTHING;
        task_order := task_order + 1;

        -- Task: Integration with SDR Portal
        INSERT INTO tasks (
            project_id, title, description, phase, status, difficulty,
            estimated_hours, ai_potential, ai_assist_description,
            tools_needed, knowledge_areas, acceptance_criteria,
            success_metrics, risks, is_foundational, is_critical_path, order_index
        ) VALUES (
            project_record.id,
            'Integration with SDR Portal',
            'Embed prioritization in SDR daily workflow.',
            'development',
            'not_started',
            'easy',
            '8-12h',
            'high',
            '',
            ARRAY['React'],
            ARRAY['Frontend/React'],
            ARRAY['Integrated in portal', 'Workflow updated', 'SDRs can access'],
            ARRAY[]::TEXT[],
            ARRAY[]::TEXT[],
            FALSE,
            FALSE,
            task_order
        ) ON CONFLICT DO NOTHING;
        task_order := task_order + 1;

        -- Task: A/B Test vs Random
        INSERT INTO tasks (
            project_id, title, description, phase, status, difficulty,
            estimated_hours, ai_potential, ai_assist_description,
            tools_needed, knowledge_areas, acceptance_criteria,
            success_metrics, risks, is_foundational, is_critical_path, order_index
        ) VALUES (
            project_record.id,
            'A/B Test vs Random',
            'Run A/B test comparing prioritized vs random contact order.',
            'testing',
            'not_started',
            'medium',
            '16-24h',
            'medium',
            '',
            ARRAY['Analytics'],
            ARRAY['Data Analytics', 'Business Logic'],
            ARRAY['Test designed', 'Results statistically significant', 'Winner determined'],
            ARRAY[]::TEXT[],
            ARRAY[]::TEXT[],
            FALSE,
            TRUE,
            task_order
        ) ON CONFLICT DO NOTHING;
        task_order := task_order + 1;

        -- Task: SDR Training
        INSERT INTO tasks (
            project_id, title, description, phase, status, difficulty,
            estimated_hours, ai_potential, ai_assist_description,
            tools_needed, knowledge_areas, acceptance_criteria,
            success_metrics, risks, is_foundational, is_critical_path, order_index
        ) VALUES (
            project_record.id,
            'SDR Training',
            'Train SDRs on using prioritization effectively.',
            'training',
            'not_started',
            'easy',
            '6-8h',
            'medium',
            '',
            ARRAY['Training materials'],
            ARRAY['Training & Documentation'],
            ARRAY['All SDRs trained', 'Documentation complete'],
            ARRAY[]::TEXT[],
            ARRAY[]::TEXT[],
            FALSE,
            FALSE,
            task_order
        ) ON CONFLICT DO NOTHING;
        task_order := task_order + 1;

        -- Task: Launch & Monitor
        INSERT INTO tasks (
            project_id, title, description, phase, status, difficulty,
            estimated_hours, ai_potential, ai_assist_description,
            tools_needed, knowledge_areas, acceptance_criteria,
            success_metrics, risks, is_foundational, is_critical_path, order_index
        ) VALUES (
            project_record.id,
            'Launch & Monitor',
            'Launch prioritization engine and monitor impact.',
            'rollout',
            'not_started',
            'easy',
            '8-12h',
            'low',
            '',
            ARRAY['Dashboards'],
            ARRAY['Change Management'],
            ARRAY['System live', 'Metrics tracked', 'Weekly reviews established'],
            ARRAY['15% improvement in conversion rate', '20% more contacts per day'],
            ARRAY[]::TEXT[],
            FALSE,
            TRUE,
            task_order
        ) ON CONFLICT DO NOTHING;
        task_order := task_order + 1;

        ELSE
            RAISE NOTICE 'Skipping contact-prioritization-engine - already has % tasks', existing_task_count;
        END IF;
    END IF;

    -- =========================================================================
    -- LEAD RECYCLING WORKFLOW
    -- =========================================================================
    SELECT id INTO project_record FROM projects WHERE slug = 'lead-recycling-workflow';
    IF project_record.id IS NOT NULL THEN
        -- Check if project already has tasks
        SELECT COUNT(*) INTO existing_task_count FROM tasks WHERE project_id = project_record.id;
        IF existing_task_count = 0 THEN
            task_order := 0;

        -- Task: Lost Lead Analysis
        INSERT INTO tasks (
            project_id, title, description, phase, status, difficulty,
            estimated_hours, ai_potential, ai_assist_description,
            tools_needed, knowledge_areas, acceptance_criteria,
            success_metrics, risks, is_foundational, is_critical_path, order_index
        ) VALUES (
            project_record.id,
            'Lost Lead Analysis',
            'Analyze reasons for lead loss and identify recyclable segments.',
            'discovery',
            'not_started',
            'medium',
            '12-16h',
            'high',
            '',
            ARRAY['Analytics', 'CRM data'],
            ARRAY['Data Analytics', 'Business Logic'],
            ARRAY['Loss reasons categorized', 'Recyclable segments identified', 'Volume quantified'],
            ARRAY[]::TEXT[],
            ARRAY[]::TEXT[],
            FALSE,
            TRUE,
            task_order
        ) ON CONFLICT DO NOTHING;
        task_order := task_order + 1;

        -- Task: Recycling Rules Design
        INSERT INTO tasks (
            project_id, title, description, phase, status, difficulty,
            estimated_hours, ai_potential, ai_assist_description,
            tools_needed, knowledge_areas, acceptance_criteria,
            success_metrics, risks, is_foundational, is_critical_path, order_index
        ) VALUES (
            project_record.id,
            'Recycling Rules Design',
            'Design rules for when and how to recycle leads.',
            'planning',
            'not_started',
            'medium',
            '8-12h',
            'medium',
            '',
            ARRAY['Documentation'],
            ARRAY['Business Logic', 'Process Design'],
            ARRAY['Rules documented', 'Cooldown periods defined', 'Re-engagement triggers set'],
            ARRAY[]::TEXT[],
            ARRAY[]::TEXT[],
            FALSE,
            FALSE,
            task_order
        ) ON CONFLICT DO NOTHING;
        task_order := task_order + 1;

        -- Task: Recycling Queue Builder
        INSERT INTO tasks (
            project_id, title, description, phase, status, difficulty,
            estimated_hours, ai_potential, ai_assist_description,
            tools_needed, knowledge_areas, acceptance_criteria,
            success_metrics, risks, is_foundational, is_critical_path, order_index
        ) VALUES (
            project_record.id,
            'Recycling Queue Builder',
            'Build automated queue that surfaces recyclable leads.',
            'development',
            'not_started',
            'medium',
            '16-24h',
            'high',
            '',
            ARRAY['Node.js', 'PostgreSQL'],
            ARRAY['Database/SQL', 'Business Logic'],
            ARRAY['Queue populating correctly', 'Rules engine working', 'Priority sorting active'],
            ARRAY[]::TEXT[],
            ARRAY[]::TEXT[],
            FALSE,
            TRUE,
            task_order
        ) ON CONFLICT DO NOTHING;
        task_order := task_order + 1;

        -- Task: Re-engagement Sequences
        INSERT INTO tasks (
            project_id, title, description, phase, status, difficulty,
            estimated_hours, ai_potential, ai_assist_description,
            tools_needed, knowledge_areas, acceptance_criteria,
            success_metrics, risks, is_foundational, is_critical_path, order_index
        ) VALUES (
            project_record.id,
            'Re-engagement Sequences',
            'Create email/WhatsApp sequences for different recycling segments.',
            'development',
            'not_started',
            'medium',
            '12-16h',
            'high',
            '',
            ARRAY['Email tools', 'WhatsApp'],
            ARRAY['Business Logic'],
            ARRAY['Sequences created per segment', 'Personalization working', 'Tracking active'],
            ARRAY[]::TEXT[],
            ARRAY[]::TEXT[],
            FALSE,
            FALSE,
            task_order
        ) ON CONFLICT DO NOTHING;
        task_order := task_order + 1;

        -- Task: SDR Portal Integration
        INSERT INTO tasks (
            project_id, title, description, phase, status, difficulty,
            estimated_hours, ai_potential, ai_assist_description,
            tools_needed, knowledge_areas, acceptance_criteria,
            success_metrics, risks, is_foundational, is_critical_path, order_index
        ) VALUES (
            project_record.id,
            'SDR Portal Integration',
            'Add recycling queue to SDR daily workflow.',
            'development',
            'not_started',
            'easy',
            '8-12h',
            'high',
            '',
            ARRAY['React'],
            ARRAY['Frontend/React'],
            ARRAY['Queue visible in portal', 'Easy to work leads', 'Stats tracked'],
            ARRAY[]::TEXT[],
            ARRAY[]::TEXT[],
            FALSE,
            TRUE,
            task_order
        ) ON CONFLICT DO NOTHING;
        task_order := task_order + 1;

        -- Task: Pilot Campaign
        INSERT INTO tasks (
            project_id, title, description, phase, status, difficulty,
            estimated_hours, ai_potential, ai_assist_description,
            tools_needed, knowledge_areas, acceptance_criteria,
            success_metrics, risks, is_foundational, is_critical_path, order_index
        ) VALUES (
            project_record.id,
            'Pilot Campaign',
            'Run pilot recycling campaign with subset of lost leads.',
            'testing',
            'not_started',
            'medium',
            '16-20h',
            'low',
            '',
            ARRAY['CRM', 'Analytics'],
            ARRAY['Business Logic'],
            ARRAY['Pilot completed', 'Conversion measured', 'Feedback collected'],
            ARRAY[]::TEXT[],
            ARRAY[]::TEXT[],
            FALSE,
            FALSE,
            task_order
        ) ON CONFLICT DO NOTHING;
        task_order := task_order + 1;

        -- Task: Launch & Scale
        INSERT INTO tasks (
            project_id, title, description, phase, status, difficulty,
            estimated_hours, ai_potential, ai_assist_description,
            tools_needed, knowledge_areas, acceptance_criteria,
            success_metrics, risks, is_foundational, is_critical_path, order_index
        ) VALUES (
            project_record.id,
            'Launch & Scale',
            'Launch recycling workflow at scale.',
            'rollout',
            'not_started',
            'easy',
            '8-12h',
            'low',
            '',
            ARRAY['Dashboards'],
            ARRAY['Change Management'],
            ARRAY['System live', 'All segments active', 'Metrics tracked'],
            ARRAY['5% of recycled leads convert', '10% increase in total conversions'],
            ARRAY[]::TEXT[],
            FALSE,
            TRUE,
            task_order
        ) ON CONFLICT DO NOTHING;
        task_order := task_order + 1;

        ELSE
            RAISE NOTICE 'Skipping lead-recycling-workflow - already has % tasks', existing_task_count;
        END IF;
    END IF;

    -- =========================================================================
    -- INSTALLER FEEDBACK SYSTEM
    -- =========================================================================
    SELECT id INTO project_record FROM projects WHERE slug = 'installer-feedback-system';
    IF project_record.id IS NOT NULL THEN
        -- Check if project already has tasks
        SELECT COUNT(*) INTO existing_task_count FROM tasks WHERE project_id = project_record.id;
        IF existing_task_count = 0 THEN
            task_order := 0;

        -- Task: Feedback Requirements
        INSERT INTO tasks (
            project_id, title, description, phase, status, difficulty,
            estimated_hours, ai_potential, ai_assist_description,
            tools_needed, knowledge_areas, acceptance_criteria,
            success_metrics, risks, is_foundational, is_critical_path, order_index
        ) VALUES (
            project_record.id,
            'Feedback Requirements',
            'Define what feedback to collect and when in the lead lifecycle.',
            'discovery',
            'not_started',
            'easy',
            '8-12h',
            'medium',
            '',
            ARRAY['Documentation'],
            ARRAY['Business Logic', 'Stakeholder Management'],
            ARRAY['Feedback fields defined', 'Timing rules set', 'Installer input gathered'],
            ARRAY[]::TEXT[],
            ARRAY[]::TEXT[],
            FALSE,
            TRUE,
            task_order
        ) ON CONFLICT DO NOTHING;
        task_order := task_order + 1;

        -- Task: Feedback Form Design
        INSERT INTO tasks (
            project_id, title, description, phase, status, difficulty,
            estimated_hours, ai_potential, ai_assist_description,
            tools_needed, knowledge_areas, acceptance_criteria,
            success_metrics, risks, is_foundational, is_critical_path, order_index
        ) VALUES (
            project_record.id,
            'Feedback Form Design',
            'Design simple feedback form optimized for mobile.',
            'planning',
            'not_started',
            'easy',
            '6-8h',
            'medium',
            '',
            ARRAY['Design tools'],
            ARRAY['UX Design'],
            ARRAY['Form designed', 'Mobile-friendly', 'Quick to complete'],
            ARRAY[]::TEXT[],
            ARRAY[]::TEXT[],
            FALSE,
            FALSE,
            task_order
        ) ON CONFLICT DO NOTHING;
        task_order := task_order + 1;

        -- Task: Feedback API & Storage
        INSERT INTO tasks (
            project_id, title, description, phase, status, difficulty,
            estimated_hours, ai_potential, ai_assist_description,
            tools_needed, knowledge_areas, acceptance_criteria,
            success_metrics, risks, is_foundational, is_critical_path, order_index
        ) VALUES (
            project_record.id,
            'Feedback API & Storage',
            'Build API to receive and store installer feedback.',
            'development',
            'not_started',
            'medium',
            '12-16h',
            'high',
            '',
            ARRAY['Node.js', 'PostgreSQL'],
            ARRAY['API Integration', 'Database/SQL'],
            ARRAY['API working', 'Data storing correctly', 'Validation in place'],
            ARRAY[]::TEXT[],
            ARRAY[]::TEXT[],
            FALSE,
            TRUE,
            task_order
        ) ON CONFLICT DO NOTHING;
        task_order := task_order + 1;

        -- Task: Feedback UI in Installer Portal
        INSERT INTO tasks (
            project_id, title, description, phase, status, difficulty,
            estimated_hours, ai_potential, ai_assist_description,
            tools_needed, knowledge_areas, acceptance_criteria,
            success_metrics, risks, is_foundational, is_critical_path, order_index
        ) VALUES (
            project_record.id,
            'Feedback UI in Installer Portal',
            'Add feedback submission to installer portal.',
            'development',
            'not_started',
            'easy',
            '8-12h',
            'high',
            '',
            ARRAY['React'],
            ARRAY['Frontend/React'],
            ARRAY['Form in portal', 'Submission working', 'Confirmation shown'],
            ARRAY[]::TEXT[],
            ARRAY[]::TEXT[],
            FALSE,
            FALSE,
            task_order
        ) ON CONFLICT DO NOTHING;
        task_order := task_order + 1;

        -- Task: Feedback Analytics Dashboard
        INSERT INTO tasks (
            project_id, title, description, phase, status, difficulty,
            estimated_hours, ai_potential, ai_assist_description,
            tools_needed, knowledge_areas, acceptance_criteria,
            success_metrics, risks, is_foundational, is_critical_path, order_index
        ) VALUES (
            project_record.id,
            'Feedback Analytics Dashboard',
            'Build dashboard to analyze feedback patterns.',
            'development',
            'not_started',
            'medium',
            '10-14h',
            'high',
            '',
            ARRAY['React', 'Chart.js'],
            ARRAY['Frontend/React', 'Data Analytics'],
            ARRAY['Dashboard deployed', 'Trends visible', 'Filtering working'],
            ARRAY[]::TEXT[],
            ARRAY[]::TEXT[],
            FALSE,
            TRUE,
            task_order
        ) ON CONFLICT DO NOTHING;
        task_order := task_order + 1;

        -- Task: Installer Training
        INSERT INTO tasks (
            project_id, title, description, phase, status, difficulty,
            estimated_hours, ai_potential, ai_assist_description,
            tools_needed, knowledge_areas, acceptance_criteria,
            success_metrics, risks, is_foundational, is_critical_path, order_index
        ) VALUES (
            project_record.id,
            'Installer Training',
            'Train installers on providing quality feedback.',
            'training',
            'not_started',
            'easy',
            '6-8h',
            'medium',
            '',
            ARRAY['Training materials'],
            ARRAY['Training & Documentation'],
            ARRAY['All installers trained', 'Guidelines documented'],
            ARRAY[]::TEXT[],
            ARRAY[]::TEXT[],
            FALSE,
            FALSE,
            task_order
        ) ON CONFLICT DO NOTHING;
        task_order := task_order + 1;

        -- Task: Launch & Monitor
        INSERT INTO tasks (
            project_id, title, description, phase, status, difficulty,
            estimated_hours, ai_potential, ai_assist_description,
            tools_needed, knowledge_areas, acceptance_criteria,
            success_metrics, risks, is_foundational, is_critical_path, order_index
        ) VALUES (
            project_record.id,
            'Launch & Monitor',
            'Launch feedback system and establish review process.',
            'rollout',
            'not_started',
            'easy',
            '6-8h',
            'low',
            '',
            ARRAY['Dashboards'],
            ARRAY['Change Management'],
            ARRAY['System live', 'Feedback flowing', 'Weekly reviews scheduled'],
            ARRAY['80% feedback submission rate', 'Actionable insights weekly'],
            ARRAY[]::TEXT[],
            FALSE,
            TRUE,
            task_order
        ) ON CONFLICT DO NOTHING;
        task_order := task_order + 1;

        ELSE
            RAISE NOTICE 'Skipping installer-feedback-system - already has % tasks', existing_task_count;
        END IF;
    END IF;

    -- =========================================================================
    -- INSTALLER QUOTE SYNC
    -- =========================================================================
    SELECT id INTO project_record FROM projects WHERE slug = 'installer-quote-sync';
    IF project_record.id IS NOT NULL THEN
        -- Check if project already has tasks
        SELECT COUNT(*) INTO existing_task_count FROM tasks WHERE project_id = project_record.id;
        IF existing_task_count = 0 THEN
            task_order := 0;

        -- Task: Quote Process Mapping
        INSERT INTO tasks (
            project_id, title, description, phase, status, diffi